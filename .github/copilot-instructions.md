# Copilot Instructions for gerenciador de restaurante

- Stack map: static cashier UI ([index.html](../index.html)+[script.js](../script.js)), static waiter UI ([garcom.html](../garcom.html)+[garcom.js](../garcom.js)), Next.js prototype ([frontend](../frontend)), and a NestJS API skeleton ([backend](../backend)). No shared build tooling at repo root.
- Backend (NestJS 10, port 3000): modules [vendas](../backend/src/vendas), [pagamentos](../backend/src/pagamentos), [fiscal](../backend/src/fiscal) are registered in [backend/src/app.module.ts](../backend/src/app.module.ts). Controllers expose simple REST routes and services return mock strings/objects—there is no DB layer yet.
  - Vendas: CRUD endpoints; DTOs define `mesa`, `itens` (see [create-venda.dto.ts](../backend/src/vendas/dto/create-venda.dto.ts)) and a manual partial update DTO ([update-venda.dto.ts](../backend/src/vendas/dto/update-venda.dto.ts)). Entity is a plain type placeholder.
  - Pagamentos: `/pagamentos/intent` and `/pagamentos/webhook` mock Stripe-style flows; `CreatePagamentoDto` carries `vendaId`, `valor` (centavos), and `metodo` enum.
  - Fiscal: `/fiscal/nfce` emit/consult endpoints simulate NFC-e issuance; DTO has `vendaId` and optional `cpfConsumidor`.
- Frontend (Next.js 14): single page at [frontend/pages/index.tsx](../frontend/pages/index.tsx) renders a PDV mock with inline data (`initialOrderItems`, `categories`, `frequentItems`) and inline style objects. No API calls; totals computed client-side. Global styles in [frontend/styles/globals.css](../frontend/styles/globals.css). Run with `cd frontend && npm install && npm run dev`.
- Static cashier experience: [script.js](../script.js) drives [index.html](../index.html) using vanilla DOM + Chart.js CDN. State lives in `localStorage`/`sessionStorage` (keys: `products`, `categories`, `restaurant_open_orders`, `session_history`). Features: category/product CRUD modals, order builder, discounts (valor/%), optional 10% service fee (manual/automatic policy), payment modal with PIX/cartão/dinheiro, cash handling (troco), cash register open/close, session logging, and category-level sales chart (doughnut via Chart.js). Keep these keys/structures stable when integrating backend.
- Static waiter experience: [garcom.js](../garcom.js) mirrors product/category browsing and order assembly; submits orders into `restaurant_open_orders` with fields `{id,time,tableId,comandaId,items,waiterName,total,status}` for the cashier view to load. Login is modal-based; session history logs under `session_history`.
- Styling/layout: both static UIs share [style.css](../style.css) (not part of Next.js). Keep modals and class names consistent when adjusting markup; inline styles are used heavily in Next.js page instead of CSS modules.
- Conventions:
  - Text, currency, and messages are in Portuguese; currency formatting uses `R$ ${valor.toFixed(2).replace('.', ',')}`.
  - Business terms: `comanda`, `mesa`, `gorjeta` (tip), `pedido`, `caixa`.
  - DTOs/entities are simple classes without decorators/validation—follow existing shape unless adding class-validator later.
- Workflows/commands: backend `cd backend && npm install && npm run start:dev`; production uses `npm run build && npm run start`. Frontend `cd frontend && npm run dev`. Static HTMLs open directly in browser; they rely on Chart.js CDN and `localStorage` data, not the Nest API.
- Integration guidance: if wiring UI to backend, map the localStorage order shape to Vendas DTOs; mirror payment intent data to Pagamentos; keep NFC-e calls aligned with `vendaId` and optional `cpfConsumidor`. Avoid breaking the localStorage contract until a migration path is added.
- Testing/status: no tests exist; services are mocks. If adding logic, prefer small unit tests per module and keep endpoints backward compatible with current placeholder responses.
